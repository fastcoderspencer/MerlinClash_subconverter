<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Clash â†’ é“¾æ¥è½¬æ¢å™¨ï¼ˆé™æ€é¡µé¢ï¼‰</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#94a3b8;--accent:#06b6d4;--glass:rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter, "Noto Sans SC", system-ui, "Helvetica Neue", Arial;
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(6,182,212,0.06), transparent 10%),
        linear-gradient(180deg,#071026 0%, #061228 100%);
      color:#e6eef6;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px;
    }

    .wrap{
      width:100%;
      max-width:1100px;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:20px;
      box-shadow: 0 8px 30px rgba(2,6,23,0.6);
      border:1px solid rgba(255,255,255,0.03);
    }

    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    header h1{font-size:16px;margin:0}
    header p{margin:0;color:var(--muted);font-size:13px}

    .cols{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }

    .card{
      background:var(--card);
      padding:12px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.02);
      min-height:300px;
      display:flex;
      flex-direction:column;
    }

    label{font-size:13px;color:var(--muted);margin-bottom:8px;display:block}
    textarea{
      width:100%;
      resize:vertical;
      min-height:200px;
      max-height:70vh;
      background:transparent;
      border:1px dashed rgba(255,255,255,0.03);
      padding:12px;
      color: #dbeafe;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Noto Sans Mono", monospace;
      font-size:13px;
      border-radius:6px;
      outline:none;
    }

    .controls{
      display:flex;
      gap:8px;
      margin-top:10px;
      align-items:center;
    }

    button{
      background:var(--glass);
      color:#e6eef6;
      border:1px solid rgba(255,255,255,0.03);
      padding:8px 10px;
      border-radius:8px;
      cursor:pointer;
      font-size:13px;
    }
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .status{margin-left:auto;color:var(--muted);font-size:13px}

    pre.output{
      margin:0;
      padding:10px;
      background:linear-gradient(180deg, rgba(0,0,0,0.05), rgba(255,255,255,0.01));
      border-radius:6px;
      height:100%;
      overflow:auto;
      white-space:pre-wrap;
      word-break:break-all;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Noto Sans Mono", monospace;
      font-size:13px;
      color:#e6eef6;
      border:1px solid rgba(255,255,255,0.02);
    }

    .footer-note{margin-top:10px;color:var(--muted);font-size:12px}
    @media (max-width:900px){
      .cols{grid-template-columns:1fr}
      textarea{min-height:180px}
    }
  </style>
</head>
<body>
  <div class="wrap" role="main">
    <header>
      <div>
        <h1>Clash YAML â†’ vmess / ss / trojan / ssr é“¾æ¥è½¬æ¢å™¨</h1>
        <p>åœ¨å·¦ä¾§ç²˜è´´æˆ–ç¼–è¾‘ Clash é…ç½®ï¼ˆproxies å­—æ®µï¼‰ï¼Œå³ä¾§ä¼šè‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„ URL åˆ—è¡¨ã€‚</p>
      </div>
      <div style="text-align:right">
        <p style="margin:0;font-size:12px;color:var(--muted)">é™æ€é¡µé¢ â€¢ æ”¯æŒç²˜è´´ JSON é£æ ¼å’Œ YAML</p>
      </div>
    </header>

    <div class="cols">
      <div class="card">
        <label for="input">è¾“å…¥ï¼šClash é…ç½® / YAMLï¼ˆæˆ–åªç²˜è´´ proxies éƒ¨åˆ†ï¼‰</label>
        <textarea id="input" placeholder="æŠŠæ•´ä¸ª clash.yaml æˆ– proxies åˆ—è¡¨ç²˜åˆ°è¿™é‡Œ..."># è¿™æ˜¯ä¾‹å­æ•°æ®ï¼Œè½¬æ¢è¯·åˆ é™¤
port: 7890
socks-port: 7891
allow-lan: true
mode: Rule
log-level: info
external-controller: 0.0.0.0:9090
proxies:
  - {"name":"ğŸ‡¿ğŸ‡¦_ZA_å—é_1","server":"156.251.191.241","port":32898,"type":"vmess","uuid":"7204d6b8-ddaf-417b-c8d8-5f983dc9f6cb","alterId":0,"cipher":"auto","country":"ğŸ‡¿ğŸ‡¦_ZA_å—é_1","skip-cert-verify":true,"tls":false,"network":"tcp"}
  - {"name":"ğŸ‡¨ğŸ‡³_CN_ä¸­å›½->ğŸ‡­ğŸ‡°_HK_é¦™æ¸¯_2","server":"120.233.10.71","port":38007,"type":"ss","country":"ğŸ‡¨ğŸ‡³_CN_ä¸­å›½->ğŸ‡­ğŸ‡°_HK_é¦™æ¸¯_2","cipher":"chacha20-ietf-poly1305","password":"66aa4ba9-8df9-4d58-ad8e-1026a2b0219b"}
  - {"name":"ğŸ‡¨ğŸ‡³_CN_ä¸­å›½->ğŸ‡¯ğŸ‡µ_JP_æ—¥æœ¬_3","server":"hncu.relay.qchwnd.moe","port":10201,"type":"trojan","country":"ğŸ‡¨ğŸ‡³_CN_ä¸­å›½->ğŸ‡¯ğŸ‡µ_JP_æ—¥æœ¬_3","skip-cert-verify":true,"udp":true,"password":"5b059403-c05c-4609-ab01-a9352041d2e4"}
  - {"name":"ğŸ‡·ğŸ‡º_RU_ä¿„ç½—æ–¯è”é‚¦_4","server":"213.183.53.200","port":9005,"type":"ssr","country":"ğŸ‡·ğŸ‡º_RU_ä¿„ç½—æ–¯è”é‚¦_4","password":"ZET59LF6DvCC8KVt","cipher":"aes-256-cfb","protocol":"origin","obfs":"plain"}
proxy-groups:
  - name: ğŸš€ èŠ‚ç‚¹é€‰æ‹©
    type: select
    proxies:
      - â™»ï¸ è‡ªåŠ¨é€‰æ‹©
      - DIRECT
      - ğŸ‡¿ğŸ‡¦_ZA_å—é_1
rules:
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼</textarea>

        <div class="controls">
          <button id="btnPasteExample" class="secondary">æ¢å¤ç¤ºä¾‹ï¼ˆé‡ç½®ï¼‰</button>
          <button id="btnClear" class="secondary">æ¸…ç©º</button>
          <button id="btnFormat" title="å°è¯•æŠŠ JSON å­—ç¬¦ä¸²ç¾åŒ–" class="secondary">æ ¼å¼åŒ– proxiesï¼ˆè‹¥ä¸º JSONï¼‰</button>
          <div class="status" id="status">å°±ç»ª</div>
        </div>
        <div class="footer-note">æç¤ºï¼šæ”¯æŒ YAML æˆ–ç›´æ¥ç²˜ JSON å¯¹è±¡æ•°ç»„ï¼ˆproxiesï¼‰ã€‚</div>
      </div>

      <div class="card">
        <label for="output">è¾“å‡ºï¼šè½¬æ¢åçš„é“¾æ¥ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰</label>
        <pre id="output" class="output" aria-live="polite"></pre>

        <div class="controls" style="margin-top:8px">
          <button id="btnCopy">å¤åˆ¶å…¨éƒ¨</button>
          <button id="btnDownload" class="secondary">ä¸‹è½½ä¸º txt</button>
          <div class="status" id="count">0 æ¡</div>
        </div>

        <div class="footer-note" id="notice">è½¬æ¢å™¨ä¼šæŠŠ proxies ä¸­æ”¯æŒçš„èŠ‚ç‚¹ï¼ˆvmess / ss / trojan / ssrï¼‰è½¬æ¢ä¸ºæ ‡å‡†é“¾æ¥ã€‚</div>
      </div>
    </div>
  </div>

  <!-- js-yaml (æµè§ˆå™¨ç‰ˆ) -->
  <script src="https://unpkg.com/js-yaml@4.1.0/dist/js-yaml.min.js"></script>

  <script>
    // ç®€ä½“ä¸­æ–‡ç•Œé¢ï¼›ä¸è¿‡æ ¸å¿ƒä»£ç å…¼å®¹å¤šæ•°è¾“å…¥æ ¼å¼
    const ta = document.getElementById("input");
    const out = document.getElementById("output");
    const status = document.getElementById("status");
    const countEl = document.getElementById("count");

    // utilities
    function utf8_to_b64(str) {
      // å¤„ç† Unicode å­—ç¬¦ï¼Œè¿”å›æ ‡å‡† base64
      return btoa(unescape(encodeURIComponent(str || "")));
    }
    function b64_to_utf8(b64) {
      return decodeURIComponent(escape(atob(b64)));
    }
    function encodeName(n) {
      return encodeURIComponent(n || "");
    }

    function tryParseProxies(inputText) {
      // å°è¯•åšå¤šç§è§£æï¼šå®Œæ•´ YAML -> å– proxiesï¼›æˆ–ç›´æ¥è§£ææˆæ•°ç»„ JSON
      try {
        const doc = jsyaml.load(inputText);
        if (doc && Array.isArray(doc.proxies)) return doc.proxies;
        // æœ‰äº›åœºæ™¯ç”¨æˆ·ç›´æ¥ç²˜äº† proxies: ä¸‹çš„å†…å®¹ï¼ˆä½œä¸º map/arrayï¼‰
        if (doc && doc.proxies && typeof doc.proxies === "object") {
          // doc.proxies å¯èƒ½ä¸ºå¯¹è±¡æˆ–å­—ç¬¦ä¸²
          if (Array.isArray(doc.proxies)) return doc.proxies;
          // else fallthrough
        }
      } catch (e) {
        // YAML è§£æå¤±è´¥ï¼Œå°è¯• JSON è§£æ
      }

      // å¦‚æœä¸Šé¢æ²¡æœ‰è¿”å›ï¼Œå°è¯•å¯»æ‰¾ "proxies:" æ®µå¹¶æŠŠåé¢éƒ¨åˆ†å½“æˆ YAML å†è§£æ
      try {
        const m = inputText.match(/proxies:\s*((?:.|\n)*)/m);
        if (m) {
          const tail = m[1];
          // æœ‰å¯èƒ½ proxies æ˜¯ç”¨ "- {...}" åˆ—è¡¨ï¼Œç›´æ¥è§£ææ•´ä¸ª text ä¸­çš„ proxies
          const sample = "proxies:" + "\n" + tail;
          const doc = jsyaml.load(sample);
          if (doc && Array.isArray(doc.proxies)) return doc.proxies;
        }
      } catch (e) { /* ignore */ }

      // å†å°è¯•æŠŠæ•´ä¸ªæ–‡æœ¬è§£ææˆ JSONï¼ˆå¯èƒ½è¾“å…¥å°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼‰
      try {
        const parsed = JSON.parse(inputText);
        if (Array.isArray(parsed)) return parsed;
        if (parsed && parsed.proxies && Array.isArray(parsed.proxies)) return parsed.proxies;
      } catch (e) { /* ignore */ }

      // å°è¯•æå–å½¢å¦‚ - { ... } çš„è¡Œï¼Œç»„è£…æˆæ•°ç»„æ–‡æœ¬
      try {
        const lines = inputText.split("\n");
        const arr = [];
        for (let ln of lines) {
          ln = ln.trim();
          if (ln.startsWith("- {") && ln.endsWith("}")) {
            // æŠŠ - { ... } å»æ‰å‰é¢çš„ "- "
            const jsonLike = ln.replace(/^-+\s*/, "");
            try {
              // å¯èƒ½ä¸æ˜¯ä¸¥æ ¼ JSONï¼ˆå•å¼•å·ï¼‰ï¼Œç”¨ YAML è§£æå•è¡Œ
              const obj = jsyaml.load(jsonLike);
              if (obj) arr.push(obj);
            } catch (e) {
              // ignore
            }
          }
        }
        if (arr.length) return arr;
      } catch (e) { /* ignore */ }

      // æœªèƒ½è§£æ
      return null;
    }

    // converter implementations
    function convertVmess(p) {
      // p å¯èƒ½æœ‰ä¸åŒå­—æ®µåï¼šuuid æˆ– idï¼›alterId æˆ– aid
      const obj = {
        v: "2",
        ps: p.name || p.ps || "",
        add: p.server || p.add || "",
        port: Number(p.port || p.port === 0 ? p.port : (p.port || "")) || "",
        id: p.uuid || p.id || p.user || "",
        aid: Number(p.alterId ?? p.aid ?? 0) || 0,
        scy: p.cipher || p.scy || "auto",
        net: p.network || p.net || "tcp",
        type: "",
        host: p.host || "",
        path: p.path || "",
        tls: (p.tls === true || String(p.tls) === "true") ? "tls" : ""
      };
      const json = JSON.stringify(obj);
      return "vmess://" + utf8_to_b64(json);
    }

    function convertSS(p) {
      // ss://base64(method:password@host:port)#name   ï¼ˆå…¼å®¹å¤šæ•°å®¢æˆ·ç«¯ï¼‰
      const method = p.cipher || p.method || p.encypt || p.esp || "";
      const pwd = p.password || p.pass || "";
      const host = p.server || p.host || "";
      const port = p.port || "";
      const core = `${method}:${pwd}@${host}:${port}`;
      return `ss://${utf8_to_b64(core)}#${encodeName(p.name || "")}`;
    }

    function convertTrojan(p) {
      const pwd = p.password || p.pass || "";
      const host = p.server || p.host || "";
      const port = p.port || "";
      // trojan æ”¯æŒå‚æ•°ï¼Œä½†è¿™é‡Œåªæ‹¼åŸºæœ¬æ ¼å¼
      return `trojan://${pwd}@${host}:${port}#${encodeName(p.name || "")}`;
    }

    function convertSSR(p) {
      // ssr:// base64( server:port:protocol:method:obfs:base64(password)/?params )
      const server = p.server || p.host || "";
      const port = p.port || "";
      const protocol = p.protocol || "origin";
      const method = p.cipher || p.method || "";
      const obfs = p.obfs || "plain";
      const password = p.password || p.pass || "";
      const pwd_b64 = utf8_to_b64(password);
      // ç»„è£…æŸ¥è¯¢å‚æ•°ï¼ˆå¯æ‰©å±•ï¼‰
      const params = [];
      if (p.name) params.push("remarks=" + utf8_to_b64(p.name));
      if (p.obfsparam) params.push("obfsparam=" + utf8_to_b64(p.obfsparam));
      if (p.protoparam) params.push("protoparam=" + utf8_to_b64(p.protoparam));
      const paramStr = params.length ? "/?" + params.join("&") : "/";
      const full = `${server}:${port}:${protocol}:${method}:${obfs}:${pwd_b64}${paramStr}`;
      return "ssr://" + utf8_to_b64(full);
    }

    function convertOne(p) {
      if (!p || typeof p !== "object") return "";
      const t = String(p.type || "").toLowerCase();
      switch (t) {
        case "vmess": return convertVmess(p);
        case "ss": return convertSS(p);
        case "trojan": return convertTrojan(p);
        case "ssr": return convertSSR(p);
        // æœ‰äº›å†²çªï¼štrojan-go ä¹Ÿå¯èƒ½ç”¨ trojan-plus ç­‰ï¼Œå°è¯•åŒ…å«å…³é”®å­—
        default:
          // å¦‚æœå¯¹è±¡é‡Œæœ‰ uuid å¾ˆå¯èƒ½æ˜¯ vmess
          if (p.uuid || p.id) return convertVmess(p);
          if (p.password && p.cipher && p.protocol) return convertSSR(p);
          if (p.password && p.cipher && p.server) return convertSS(p);
          return "";
      }
    }

    function convertAllFromText(text) {
      const proxies = tryParseProxies(text);
      if (!proxies) {
        out.textContent = "// æ— æ³•è§£æ proxiesã€‚è¯·ç¡®è®¤è¾“å…¥ä¸ºæ­£ç¡®çš„ YAML/JSONï¼Œæˆ–ç›´æ¥åœ¨ proxies: ä¸‹ç²˜å…¥èŠ‚ç‚¹åˆ—è¡¨ã€‚";
        countEl.textContent = "0 æ¡";
        return;
      }
      const results = [];
      for (const p of proxies) {
        try {
          const url = convertOne(p);
          if (url) results.push(url);
        } catch (e) {
          // å¿½ç•¥å•ä¸ªèŠ‚ç‚¹å¼‚å¸¸
          console.warn("convert node error", e, p);
        }
      }
      out.textContent = results.join("\n");
      countEl.textContent = results.length + " æ¡";
    }

    // debounce helper
    function debounce(fn, wait){
      let t = null;
      return function(...a){ clearTimeout(t); t = setTimeout(()=>fn.apply(this,a), wait); };
    }

    const doConvert = debounce(()=> {
      status.textContent = "è½¬æ¢ä¸­...";
      try {
        convertAllFromText(ta.value);
        status.textContent = "å·²æ›´æ–°";
      } catch (e) {
        status.textContent = "è½¬æ¢å‡ºé”™";
        out.textContent = "// å‘ç”Ÿé”™è¯¯ï¼š" + (e && e.message ? e.message : String(e));
        countEl.textContent = "0 æ¡";
      }
    }, 240);

    ta.addEventListener("input", doConvert);
    // åˆå§‹åŒ–
    window.addEventListener("load", () => { doConvert(); });

    // æŒ‰é’®åŠŸèƒ½
    document.getElementById("btnClear").addEventListener("click", ()=>{
      ta.value = "";
      doConvert();
      status.textContent = "å·²æ¸…ç©º";
    });

    document.getElementById("btnPasteExample").addEventListener("click", ()=>{
      // æ¢å¤å†…ç½®ç¤ºä¾‹æ–‡æœ¬ï¼ˆé¡µé¢é¡¶éƒ¨é»˜è®¤æ–‡æœ¬ï¼‰
      const defaultText = `# è¿™æ˜¯ä¾‹å­æ•°æ®ï¼Œè½¬æ¢è¯·åˆ é™¤
port: 7890
socks-port: 7891
allow-lan: true
mode: Rule
log-level: info
external-controller: 0.0.0.0:9090
proxies:
  - {"name":"ğŸ‡¿ğŸ‡¦_ZA_å—é_1","server":"156.251.191.241","port":32898,"type":"vmess","uuid":"7204d6b8-ddaf-417b-c8d8-5f983dc9f6cb","alterId":0,"cipher":"auto","country":"ğŸ‡¿ğŸ‡¦_ZA_å—é_1","skip-cert-verify":true,"tls":false,"network":"tcp"}
  - {"name":"ğŸ‡¨ğŸ‡³_CN_ä¸­å›½->ğŸ‡­ğŸ‡°_HK_é¦™æ¸¯_2","server":"120.233.10.71","port":38007,"type":"ss","country":"ğŸ‡¨ğŸ‡³_CN_ä¸­å›½->ğŸ‡­ğŸ‡°_HK_é¦™æ¸¯_2","cipher":"chacha20-ietf-poly1305","password":"66aa4ba9-8df9-4d58-ad8e-1026a2b0219b"}
  - {"name":"ğŸ‡¨ğŸ‡³_CN_ä¸­å›½->ğŸ‡¯ğŸ‡µ_JP_æ—¥æœ¬_3","server":"hncu.relay.qchwnd.moe","port":10201,"type":"trojan","country":"ğŸ‡¨ğŸ‡³_CN_ä¸­å›½->ğŸ‡¯ğŸ‡µ_JP_æ—¥æœ¬_3","skip-cert-verify":true,"udp":true,"password":"5b059403-c05c-4609-ab01-a9352041d2e4"}
  - {"name":"ğŸ‡·ğŸ‡º_RU_ä¿„ç½—æ–¯è”é‚¦_4","server":"213.183.53.200","port":9005,"type":"ssr","country":"ğŸ‡·ğŸ‡º_RU_ä¿„ç½—æ–¯è”é‚¦_4","password":"ZET59LF6DvCC8KVt","cipher":"aes-256-cfb","protocol":"origin","obfs":"plain"}
proxy-groups:
  - name: ğŸš€ èŠ‚ç‚¹é€‰æ‹©
    type: select
    proxies:
      - â™»ï¸ è‡ªåŠ¨é€‰æ‹©
      - DIRECT
      - ğŸ‡¿ğŸ‡¦_ZA_å—é_1
rules:
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼`;
      ta.value = defaultText;
      doConvert();
      status.textContent = "å·²æ¢å¤ç¤ºä¾‹";
    });

    document.getElementById("btnFormat").addEventListener("click", ()=>{
      // å°è¯•æŠŠé€‰åŒºæˆ–æ•´ä¸ªå†…å®¹å½“ä½œ JSON æ•°ç»„æ ¼å¼åŒ–ï¼ˆä»…å½“è¾“å…¥ä¸º JSON æ—¶æœ‰æ•ˆï¼‰
      try {
        let t = ta.value.trim();
        if (!t) return;
        // å¦‚æœåŒ…å« proxies: å°è¯•è§£æå¹¶æŠŠ proxies éƒ¨åˆ†ç¾åŒ–
        const parsed = jsyaml.load(t);
        if (parsed && parsed.proxies && Array.isArray(parsed.proxies)) {
          const pretty = JSON.stringify(parsed.proxies, null, 2);
          ta.value = pretty;
          doConvert();
          status.textContent = "å·²æ ¼å¼åŒ– proxies ä¸º JSON æ•°ç»„";
          return;
        }
        // å¦åˆ™å°è¯• JSON.parse
        const p2 = JSON.parse(t);
        ta.value = JSON.stringify(p2, null, 2);
        doConvert();
        status.textContent = "å·²æ ¼å¼åŒ–ï¼ˆJSONï¼‰";
      } catch (e) {
        status.textContent = "æ ¼å¼åŒ–å¤±è´¥";
      }
    });

    document.getElementById("btnCopy").addEventListener("click", async ()=>{
      try {
        await navigator.clipboard.writeText(out.textContent || "");
        status.textContent = "å·²å¤åˆ¶åˆ°å‰ªè´´æ¿";
      } catch (e) {
        status.textContent = "å¤åˆ¶å¤±è´¥";
      }
    });

    document.getElementById("btnDownload").addEventListener("click", ()=>{
      const blob = new Blob([out.textContent || ""], {type:"text/plain;charset=utf-8"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "converted_proxies.txt";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      status.textContent = "å·²ä¸‹è½½";
    });

    // å…è®¸å¤–éƒ¨å¿«é€Ÿè½¬æ¢ï¼ˆæ§åˆ¶å°å¯è°ƒç”¨ï¼‰
    window.convertClashToLinks = function (text) {
      return (function(){
        try {
          const proxies = tryParseProxies(text);
          if (!proxies) return [];
          return proxies.map(convertOne).filter(Boolean);
        } catch (e) { return []; }
      })();
    };
  </script>
</body>
</html>